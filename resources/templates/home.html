{% extends "base.html" %} {% block content %}
<div id="mainBody" class="jumbotron">
    <ul class="nav nav-tabs nav-justified" role="tablist">
        <li role="presentation" class="active">
            <a href="#myworkouts-list" aria-controls="myworkouts-list" role="tab" data-toggle="tab">My Workouts</a>
        </li>

        <li role="presentation">
            <a href="#myentries-list" aria-controls="myentries-list" role="tab" data-toggle="tab">My entries</a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="myworkouts-list" class="list-group tab-pane active" role="tabpanel">
            {% for workout in my-workouts %}
            <a href="#" class="list-group-item">
                <h4 class="list-group-item-heading">{{workout.workout_title}}</h4>
                <p class="list-group-item-text">{{workout.workout_text}}</p>
            </a>
            {% endfor %}
            <button id="showCreateDialogButton" class="btn btn-primary btn-lg">Create Workout</button>
            <!-- <a id="createWorkoutButton" class="btn btn-primary btn-lg" href="#"  -->
            <!--    data-toggle="modal" data-target="#createWorkoutModal">Create Workout</a> -->
        </div>

        <div id="myentries-list" class="list-group tab-pane" role="tabpanel">
            {% for an-entry in my-entries %}
            <a href="#" class="list-group-item"> {{user.first_name}} - {{user.last_name}}</a> {% endfor %}
        </div>
    </div>


    <div id="createWorkoutModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Create a Workout</h4>
                </div>
                <div class="modal-body">
                    <form id="createWorkoutForm" action="/createWorkout" method="POST">
                        {% csrf-field %}
                        <div id="workoutTitleDiv" class="input-group">
                            <!-- <span class="input-group-addon" id="basic-addon1">Title</span> -->
                            <label for="workoutTitle">Title:</label>
                            <input type="text" class="form-control" id="workoutTitle" name="title" placeholder="Title" aria-describedby="basic-addon1">
                            <br/>
                            <span class="error">This field is required</span>
                        </div>
                        <br/>

                        <div id="workoutDescDiv" class="form-group">
                            <label for="workoutDesc">Description:</label>
                            <textarea class="form-control" rows="5" id="workoutDesc" name="desc"></textarea>
                            <span class="error">This field is required</span>
                        </div>

                        <div id="startDateDiv" class='form-group'>
                            <label>Start date time(yyyy-MM-dd hh:mm:ss)</label>
                            <input type='text' class="form-control" id="startDateInput" name="startDateInput" data-format="yyyy-MM-dd hh:mm:ss" />
                            <span class="error">This field is required</span>
                        </div>

                        <div id="endDateDiv" class='form-group'>
                            <label>End date time(yyyy-MM-dd hh:mm:ss)</label>
                            <input type='text' class="form-control" id="endDateInput" name="endDateInput" data-format="yyyy-MM-dd hh:mm:ss" />
                            <span class="error">This field is required</span>
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="createWorkoutButton">Create It! Yeah</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
            <!-- end of modal-content -->
        </div>

    </div>

</div>
{% endblock %} {% block page-scripts %}
<script type="text/javascript">
    var username = "{{user.username}}";

    function isEmpty(str) {
        return (!str || 0 === str.length);
    }

    function OnCreateWorkOutClick() {
        jQuery('#showCreateDialogButton').click(function() {

            jQuery('#createWorkoutModal').modal('show');

            var now = new Date();
            //The following is possible because of the date.format.js file
            var nowAsText = now.format("yyyy-mm-dd hh:MM:ss");

            jQuery('#startDateInput').val(nowAsText);
            hideErrorFields();
            OnCreateYeahClicked();
        });
    }

    function hideErrorFields() {
        jQuery('#workoutTitleDiv .error').hide();
        jQuery('#workoutDescDiv .error').hide();

        jQuery('#startDateDiv .error').hide();
        jQuery('#endDateDiv .error').hide();
    }

    function OnCreateYeahClicked() {
        jQuery('#createWorkoutButton').click(function(e) {
            e.preventDefault();
            var titleText = jQuery('#workoutTitle').val();
            var descText = jQuery('#workoutDesc').val();

            var startDate = jQuery('#startDateInput').val();
            var endDate = jQuery('#endDateInput').val();

            validateWorkoutData(titleText, descText, startDate, endDate);
        });
    }

    function validateWorkoutData(title, desc, start, end) {
        var errorPresent = false;

        var dateOkRegex = /\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/;
        var startDateOk = dateOkRegex.test(start);
        var endDateOk = dateOkRegex.test(end);
        //console.log("startDateOk: " + startDateOk + ", endDateOk: " + endDateOk);

        if (isEmpty(title)) {
            errorPresent = true;
            jQuery('#workoutTitleDiv .error').show();
        }
        if (isEmpty(desc)) {
            errorPresent = true;
            jQuery('#workoutDescDiv .error').show();
        }
        if (isEmpty(start)) {
            errorPresent = true;
            jQuery('#startDateDiv .error').show();
        }
        if (isEmpty(end)) {
            errorPresent = true;
            jQuery('#endDateDiv .error').show();
        }
        if (!errorPresent) {
            var hiddenField = '<input type="hidden" name="username" value="{{user.username}}" />';

            jQuery('#createWorkoutForm').prepend(hiddenField);
            var theStartDate = jQuery('#createWorkoutForm input[name=startDateInput]').val();
            var theEndDate = jQuery('#createWorkoutForm input[name=endDateInput]').val();
    console.log("The start date: " + theStartDate);
    console.log("The end date: " + theEndDate);

    //jQuery('#input[name=startDateInput]').attr('value', "2015-09-20 10:42:18");
    //jQuery('#input[name=endDateInput]').attr('value', "2015-09-20 11:42:18");

    //theStartDate = jQuery('#createWorkoutForm input[name=startDateInput]').val();
    //var theEndDate = jQuery('#createWorkoutForm input[name=endDateInput]').val();
    //console.log("The start date: " + theStartDate);
    //console.log("The end date: " + theEndDate);
            
            jQuery('#createWorkoutForm').submit();
        }
    }

    jQuery(document).ready(function() {
        OnCreateWorkOutClick();
    });
</script>

{% endblock %}
